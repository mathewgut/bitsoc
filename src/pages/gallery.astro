---
import GalleryItems from "@/components/GalleryItems";
import BaseLayout from "@/layouts/BaseLayout.astro";

const apiKey = import.meta.env.API_KEY;
const endpoint = "https://bitsoc.ca/manage/api/files/gallery?token=" + String(apiKey);

let data;
let error = false;

if (!apiKey) {
    console.error("API KEY is not set in .env file");
    error = true
}

try {
    const res = await fetch(endpoint);

    if (!res.ok) {
        error = true
        throw new Error(`Failed to fetch from backend: ${res.statusText}`);
    }

    data = await res.json();

} 
catch (error) {
    error = true
}
---

<BaseLayout title="Gallery">
   <main class="flex flex-col items-center w-full gap-10 justify-center px-12 lg:px-20 pb-20 pt-10 scroll-smooth">
        <header class="flex flex-col gap-4">
            <h1 class="text-4xl font-semibold text-center">Gallery Page</h1>
            <p class="text-center max-w-2xl">
                Welcome to the gallery! Here you will find a collection of images and media showcasing our events and activities.
            </p>
        </header>
        { error &&

            <div class="flex flex-col gap-2 w-fit h-fit justify-center items-center py-4 px-8 shadow-md rounded-md border-2 border-bitsoc-blue/50">
                <h2 class="sm:text-lg font-semibold">Oops! Something went wrong loading the gallery.</h2>
                <p class="text-sm">Try again later. If the issue persists feel free to reach out to us.</p>
            </div>
        }
        { data &&
            <GalleryItems data={data} client:only />
        }
        
   </main>
</BaseLayout>